@(recording: Option[domain.Recording])(implicit r: RequestHeader, flash: Flash)

@main(title = "Realtime Stream") {

  @if(recording.isDefined) {

    
  <div class="row-fluid meters">
    <ul class="thumbnails">

      @for(gateway <- recording.get.configuredGateways) {
        @for(device <- gateway.devices) {
          @for(tableId <- device.tableIds) {
            <li class="span6">
              <div class="thumbnail">
                <h4>@gateway.host:@gateway.port Unit @device.unit Table @tableId</h4>
                @for(registerRow <- device.registers(tableId).grouped(4)) {
                  <div class="row-fluid">
                  @for(register <- registerRow) {
                    <div class="span3 keep-side-by-side">
                      <canvas class="gauge" width="100" height="100"></canvas>
                      <h6 class="align-center register-address-label">@register.name</h6>
                      <p class="align-center register-value-label"></p>
                    </div>
                  }
                  </div>
                }
              </div>
            </li>
          }
        }
      }

    </ul>
  </div>


    <script language="javascript" type="text/javascript">
      var Jem = Jem || {};
      Jem.realtime = Jem.realtime || {};
      Jem.realtime.wsUri = "@routes.Application.watchRealtimeStream.webSocketURL()";
    </script>

    <script src="@routes.Assets.at("javascripts/handlebars.js")"
            type="text/javascript"></script>
    <script src="@routes.Assets.at("javascripts/gauge.min.js")"
            type="text/javascript"></script>
    <script src="@routes.Assets.at("javascripts/smoothie.js")"
            type="text/javascript"></script>
    <!--<script src="@routes.Assets.at("javascripts/realtime.js")"
      type="text/javascript"></script>-->

    <div class="row-fluid">
      <ul id="meters" class="meters thumbnails">
        <script id="register-template" type="text/x-handlebars-template">
          <li class="meter span1 register-address-{{address}}">
            <div class="thumbnail">
              <canvas class="gauge" width="100" height="100"></canvas>
              <h4 class="register-address-label">{{address}}</h4>
              <p class="register-value-label">{{value}}</p>
            </div>
          </div>
        </script>
      </div>
    </div>

  } else {
    <p>There is no realtime stream of data right now.</p>
  }
  
}

